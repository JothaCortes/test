{{!< layout/default}}

{{#extend "css"}}
<style>
.info-box {
    box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);
    border-radius: .25rem;
    padding: .5rem;
    min-height: 80px;
    background: #fff;
    display: flex!important; 
    margin-top:10px;
    font-size: 20px;
}
.info-box-icon {
    border-radius: .25rem;
    display: block;
    width: 90px;
    text-align: center;
    font-size: 40px;
    color: #fff!important;
}
.btn-warning:disabled {
    color: #fff;
    background-color: #FF7518;
    border-color: #FF7518;
}
.btn-warning {
    color: #fff;
    background-color: #FF7518;
    border-color: #FF7518;
}
.card-header{
    background-color: #9dacea;
    color:#333333;
    padding: 0.2rem 1.25rem;
  }
  
    
.h5{
    margin-bottom: 0rem;
}

</style>
{{/extend}}
<div class="col-md-12" >
    <div class="row"> 
        <div class="offset-md-10 col-md-2" >  
            <label><h5>Sede: {{{ credentials.place }}}</h5></label>
        </div>
      <br>    
    </div>
</div> <hr>
<div class="col-md-12">
        <ul class="nav nav-pills mb-3 nav-justified" id="pills-tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true">Matriculados</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false">Retirados</a>
            </li>
        </ul>
    <div class="tab-content" id="pills-tabContent">
        <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                <div class="row">
                    <div class="col-md-2 col-xs-12">
                        <br>
                        <button class="btn btn-primary btn-block" id="pagosEnrolled" disabled>
                            <i class="fa fa-plus"></i> Pagos
                        </button>
                        <button class="btn btn-warning btn-block" id="modStudentEnrolled" disabled>
                            <i class="fas fa-edit"></i> Modificar
                        </button>
                        <button class="btn btn-success btn-block" id="optionStudentEnrolled" disabled>
                            <i class="fas fa-ban"></i> Opciones
                        </button>
                        <button class="btn btn-danger btn-block" id="closeMatrStudentEnrolled" disabled>
                                <i class="fas fa-ban"></i> Cerrar Matrícula
                        </button>
                    </div>
                
                    <div class="col-md-10 col-xs-12 box-shadows table-responsive">
                        <table id="tableEnrolledAlumns" class="display nowrap table table-condensed" cellspacing="0" width="100%">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>Rut</th>
                                    <th>Nombre</th>
                                    <th>Apellidos</th>
                                    <th></th>
                                    <th>Domicilio</th>
                                    <th>E-mail</th>
                                    <th>Celular</th>
                                    <th>Apoderado</th>
                                    <th>Parentesco</th>
                                </tr>
                            </thead>
                        </table>
                        <div id="loadingEnrolled">
                            <center>
                                <i style="color:#3498db;" class="fa fa-spinner fa-pulse fa-2x fa-fw"></i>
                                <span class="sr-only">Cargando...</span>
                            </center>
                        </div>
                    </div>
                </div>
        </div>
    
    
        <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
            <div class="container-fluid">
                <div class="tab-content">
                    <div class="tab-pane fade show active" style="margin-left:10px;margin-right:10px" id="#" role="tabpanel" aria-labelledby="enables-tab">
                        <div class="row">
                            <div class="col-md-2 col-xs-12">
                                <br>
                                <button class="btn btn-primary btn-block" id="x" disabled>
                                    <i class="fa fa-plus"></i> Pagos
                                </button>
                                <button class="btn btn-warning btn-block" id="x" disabled>
                                    <i class="fas fa-edit"></i> Modificar
                                </button>
                                <button class="btn btn-success btn-block" id="x" disabled>
                                    <i class="fas fa-ban"></i> Opciones
                                </button>
                                <button class="btn btn-danger btn-block" id="x" disabled>
                                        <i class="fas fa-ban"></i> Cerrar Matrícula
                                </button>
                            </div>
                        
                            <div class="col-md-10 col-xs-12 box-shadows table-responsive">
                                <table id="tableDisabledAlumns" class="display nowrap table table-condensed" cellspacing="0" width="100%">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Sede</th>
                                            <th>Rut</th>
                                            <th>Nombre</th>
                                            <th>Apellidos</th>
                                            <th></th>
                                            <th>Domicilio</th>
                                            <th>E-mail</th>
                                            <th>Celular</th>
                                            <th>Apoderado</th>
                                            <th>Parentesco</th>
                                        </tr>
                                    </thead>
                                </table>
                                <div id="loadingDisabled">
                                    <center>
                                        <i style="color:#3498db;" class="fa fa-spinner fa-pulse fa-2x fa-fw"></i>
                                        <span class="sr-only">Cargando...</span>
                                    </center>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> 
            </div>
        </div>
    </div>
</div>

<!-- Modal formato-->
<div class="modal fade" id="modalEstudiantes" tabindex="-1" role="dialog" aria-labelledby="modal_title" >
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="background-color: #ffffff">
            <div class="modal-header" style="background:#333333; color:#fff">
                <h5 class="modal-title" id="modal_title"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="modal_body"></div>
            <div class="modal-footer" id="modal_footer"></div>
        </div>
    </div>
</div>
{{#extend "js"}}
<script src="/public/logoCebalB64/logoCebal.js"></script>
<script src="/public/logoCebalB64/perfilAlumno.js"></script>
<script>
    
let defaultModalHTML = '';
let datatable;
let datatableAlumnosEnrolled;
let alumosRowSelectedData;

    jQuery(document).ready(function ($) {
        chargeTableAlumnos();
        chargeTableAlumnosDisabled();
    });
       
    function chargeTableAlumnos() {
        datatableAlumnosEnrolled = $('#tableEnrolledAlumns')
        .DataTable({            
                    "iDisplayLength": 100,
                    "oLanguage": {
                        "sSearch": "Buscar :"
                    },
                    "responsive": true,
                    "columns": [
                        { "defaultContent": "<button type='button' class='see1 btn btn-outline-info btn-sm' title='Información adicional'> <i class='fas fa-chart-bar' style=' width: 14px'></i></button>"},
                        { "data": "_id"},
                        { "data": "name" },
                        { "data": "lastname1"},
                        { "data": "lastname2"},
                        { "data": "address"},
                        { "data": "email"},
                        { "data": "phone"},
                        { "data": "nameAp"},
                        { "data": "relationshipAp"}               
                    ],
                initComplete: function (settings, json) {
                    ajax({
                        url: 'api/studentsEnrolled'
                    }).then(res => {
                        if (res.err) {
                            toastr.warning('No existen Alumnos')
                        } else {
                            datatableAlumnosEnrolled.rows.add(res).draw();
                            $('#loadingEnrolled').empty();
                        }      
                    })
                }
        });   
        
     $('#tableEnrolledAlumns tbody').on('click', 'tr', function () {
        if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
            $('#pagosEnrolled').prop('disabled', true);
            $('#optionStudentEnrolled').prop('disabled', true);
            $('#modStudentEnrolled').prop('disabled', true);
            $('#closeMatrStudentEnrolled').prop('disabled', true);
        } else {
            datatableAlumnosEnrolled.$('tr.selected').removeClass('selected');
            $(this).addClass('selected');
            alumosRowSelectedData = datatableAlumnosEnrolled.row($(this)).data();
            console.log(alumosRowSelectedData)
            $('#pagosEnrolled').prop('disabled', false);
            $('#optionStudentEnrolled').prop('disabled', false);
            $('#modStudentEnrolled').prop('disabled', false);
            $('#closeMatrStudentEnrolled').prop('disabled', false);
        }
    });
}
//DATATABLE FINAL recargar
function reloadTableAlumnosEnrolled() {
        ajax({
            url: 'api/studentsEnrolled'
        }).then(res => {
            if (res.err) {
                toastr.warning('No existen alumnos matriculados')
            } else {
                datatableAlumnosEnrolled.clear().draw();
                datatableAlumnosEnrolled.rows.add(res).draw();
            }
        })
}

let datatableAlumnosDisabled;
let alumosRowSelectedDataDisabled;
//DATATABLE DISABLED ALUMNOS
function chargeTableAlumnosDisabled() {
    datatableAlumnosDisabled = $('#tableDisabledAlumns')
        .DataTable({            
                    "iDisplayLength": 100,
                    "oLanguage": {
                        "sSearch": "Buscar :"
                    },
                    "responsive": true,
                    "columns": [
                        { "defaultContent": "<button type='button' class='see1 btn btn-outline-info btn-sm' title='Información adicional'> <i class='fas fa-chart-bar' style=' width: 14px'></i></button>"},
                        {"data": "city"},
                        { "data": "_id"},
                        { "data": "name" },
                        { "data": "lastname1"},
                        { "data": "lastname2"},
                        { "data": "address"},
                        { "data": "email"},
                        { "data": "phone"},
                        { "data": "nameAp"},
                        { "data": "relationshipAp"}               
                    ],
                initComplete: function (settings, json) {
                    ajax({
                        url: 'api/studentsDisabled'
                    }).then(res => {
                        if (res.err) {
                            toastr.warning('No existen Alumnos')
                        } else {
                            datatableAlumnosDisabled.rows.add(res).draw();
                            $('#loadingDisabled').empty();
                        }      
                    })
                }
        });   
        
    

     $('#tableDisabledAlumns tbody').on('click', 'tr', function () {
        if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
           /* $('#pagosEnrolled').prop('disabled', true);
            $('#optionStudentEnrolled').prop('disabled', true);
            $('#modStudentEnrolled').prop('disabled', true);
            $('#closeMatrStudentEnrolled').prop('disabled', true);*/
        } else {
            datatableAlumnosDisabled.$('tr.selected').removeClass('selected');
            $(this).addClass('selected');
            alumosRowSelectedDataDisabled = datatableAlumnosDisabled.row($(this)).data();
            console.log(alumosRowSelectedDataDisabled)
           /* $('#pagosEnrolled').prop('disabled', false);
            $('#optionStudentEnrolled').prop('disabled', false);
            $('#modStudentEnrolled').prop('disabled', false);
            $('#closeMatrStudentEnrolled').prop('disabled', false);*/
        }
    });
}
//DATATABLE FINAL recargar
function reloadTableAlumnosDisabled() {
        ajax({
            url: 'api/studentsDisabled'
        }).then(res => {
            if (res.err) {
                toastr.warning('No existen alumnos matriculados')
            } else {
                datatableAlumnosDisabled.clear().draw();
                datatableAlumnosDisabled.rows.add(res).draw();
            }
        })
}
//XXXXXXXXXX
//CERRAR MATRICULA
$('#closeMatrStudentEnrolled').on('click', function(){
    console.log(alumosRowSelectedData)
    swal({
        title: '¿Estás seguro?',
        text: 'Podrás revertir esta acción desde la pestaña "clientes deshabilitados"',
        type: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Si, deshabilitar!',
        cancelButtonText: 'No, cancelar!',
        confirmButtonClass: 'btn btn-primary',
        cancelButtonClass: 'btn btn-default',
        buttonsStyling: false,
        animation: false,
        customClass: 'animated tada'
    }).then(function () {
		$.ajax({
            url: '/api/deshabilitarAlumno',
            type: 'DELETE',
            data: {
            estudianteDes: alumosRowSelectedData._id
          }    
        }).done(function(data) {
		if (data.ok) {
                alumosRowSelectedData.remove().draw();
                var newRowAdded = datatable2.row.add( {
                    "name": selectedClientData.name,
                    "rut": selectedClientData.rut
                }).draw().node();
                $( newRowAdded ).css( 'color', '#f1c40f' );

                setTimeout(function() {
                    $( newRowAdded ).css( 'color', 'black' );
                }, 6000);
                $('#modButton').prop('disabled', true);
                $('#desButton').prop('disabled', true);
                swal(
                    'Deshabilitado!',
                    data.ok,
                    'success'
                )
            }
        })
        .fail(function() {
            console.log("error al deshabilitar cliente");
        });
	});
});
//XXXXXXXXXXXXXXXXXXXXX
//Opciones estudiante
$('#optionStudentEnrolled').on('click', function(){
    opcionesModal();
})
function opcionesModal() { 
      $('#modalEstudiantes').modal();
      $('#modal_title').text('Opciones');
      $('#modal_body').html(`
        <div class="row">
            <div class="col-md-6 col-sm-6 col-xs-12">
                <div class="info-box">
                    <span class="info-box-icon bg-info elevation-1"><i class="fas fa-align-justify"></i></span>
                    <div class="info-box-content">
                    <span class="info-box-text"><h5><a class="dropdown-item" href="#">Asistencia</a></h5></span>
                    <p style="margin-left: 25px"> 1024</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-sm-6 col-xs-12">
                <div class="info-box">
                    <span class="info-box-icon bg-info elevation-1" style="background-color: #23ad67 !important;"><i class="fas fa-book"></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text"><h5><a class="dropdown-item" href="#"> Puntajes</a></h5></span>
                        <p style="margin-left: 25px"> 845</p>
                    </div>
                </div>
            </div>
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="info-box">
                    <span class="info-box-icon bg-info elevation-1" style="background-color: #ef3f3f !important;"><i class="fas fa-book"></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text"><h5><a class="dropdown-item" href="#"> Documentos</a></h5></span>
                        <div class="row">
                            <div class="offset-md-1 col-md-3">
                                <label id="certificadoMatr">Matrícula</label>
                            </div>
                            <div class="offset-md-3 col-md-4">
                                <label id="certificadoRegular">Alumno regular</label>
                            </div>
                        </div>    
                    </div>
                </div>
            </div>
        </div>
       
     `)
    
     $('#certificadoMatr').on('click', function () {
         defaultModalHTML = $('#modal_body').html()
         $('#modal_body').empty()
      
        $('#modal_body').html(`
        <div class="row"> 
            <div class="col-md-3" style="margin-top:15px;">
                <button id="Atrás" class="btn btn-danger btn-block"><i class="fas fa-ban"></i> Atrás</button>
            </div>
            <div class="col-md-3" style="margin-top:15px;">
                <button id="printPDF" class="btn btn-primary btn-block"><i class="fas fa-cloud"></i> Imprimir</button>
            </div>

            <div class="col-md-12" id="matriculaImprimir" style="margin-top:20px">
                <div class="row">
                    <div class="col-md-2 col-xs-12">
                        <img class="card-img-top" src="/public/img/logo.png" width:"100%">
                    </div>
                <div class="offset-md-2 col-md-4">
                        <label><h5><u>Ficha de Matrícula</u></h5></label><br>
                        <label> Preuniversitario CEBAL </label>  
                    </div> 
                    <div class="col-md-2 col-xs-12">
                        <img class="card-img-top" src="/public/img/carnet2.jpg" width:"100%">
                    </div>
                </div>
                <div class="row" style="margin-top:-35px;">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                        <label><b> Nombre completo</b></label>
                    </div>
                    <div class="col-md-5 col-sm-6">
                        <label>${alumosRowSelectedData.name + " " + alumosRowSelectedData.lastname1 + " " + alumosRowSelectedData.lastname2}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                        <label><b> Rut</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData._id}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                        <label><b> Fecha de nacimiento</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                        <label>${alumosRowSelectedData.birthday}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                        <label><b> Domicilio</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.address}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                        <label><b> Celular</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                        <label>${alumosRowSelectedData.phone}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                        <label><b> Correo</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.email}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                            <label><b> Colegio</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.colegio}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                            <label><b> Año de egreso</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.añoEgreso}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                        <label><b> Promedio</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.promedio}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                            <label><b> Horario</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.horario}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                            <label><b> Prueba optativa</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.electivo}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                            <label><b> Apoderado</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.apoderado}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                            <label><b> Parentesco</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.parentesco}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                            <label><b> Lugar de trabajo</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.workAp}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                            <label><b> Celular apoderado</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.phoneAp}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                            <label><b> Fecha de matrícula</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.date}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                            <label><b> Tipo de curso</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.tipoCurso}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-md-2 col-md-3 col-sm-6">
                            <label><b> Forma de pago</b></label>
                    </div>
                    <div class="col-md-6 col-sm-6">
                         <label>${alumosRowSelectedData.formaP}</label>
                    </div>
                </div><br><br>
                <div class="row">
                    <div class="offset-md-1 col-md-11 col-sm-11">
                        <center><label>Dirección: Manuel Montt #358 - Contacto: contacto@cebal.cl - Fono: 75 2320402 - www.cebal.cl</label>
                        <label>CEBAL Sólido eN P.S.U</label></center>
                        </div>
                </div>
            </div>
        </div>
            `)
        $('#Atrás').on('click', function () {
            $('#modal_body').html(defaultModalHTML)
        })
        $('#printPDF').on('click', function () {
            var doc = new jsPDF();
            doc.setDrawColor(0, 0, 0);
            doc.setFontSize(16);
            doc.setFontType("bold")
            doc.text(85,50,"Ficha de Matrícula");
            doc.line(85, 52, 134, 52);
            doc.setFontSize(10);
            doc.setFontType("normal");
            doc.text(90,58,"Preuniversitario CEBAL");
            
            
            doc.addImage(logoCebal, 'JPEG', 20, 30, 30, 10);
            //doc.addImage(perfil, 'JPEG', 150, 52, 35, 45);
                
            doc.setFontType("bold");
            doc.text(40,78,"N° Matrícula");
            doc.setFontType("normal");
            doc.text(85,78,"2");

            doc.setFontType("bold");
            doc.text(40,85,"Año");
            doc.setFontType("normal");
            doc.text(85,85,moment(alumosRowSelectedData.date).format('YYYY'));
            
            doc.line(40, 88, 134, 88);
            doc.setFontSize(11);
            doc.setFontType("bold");
            doc.text(40,94,"Nombre Completo");
            doc.setFontType("normal");
            doc.text(85,94,alumosRowSelectedData.name + " " + alumosRowSelectedData.lastname1 + " " + alumosRowSelectedData.lastname2);

            doc.setFontType("bold");
            doc.text(40,101,"Rut");
            doc.setFontType("normal");
            doc.text(85,101,alumosRowSelectedData._id);

            doc.setFontType("bold");
            doc.text(40,108,"Fecha de nacimiento");
            doc.setFontType("normal");
            doc.text(85,108,alumosRowSelectedData.birthday);

            doc.setFontType("bold");
            doc.text(40,115,"Domicilio");
            doc.setFontType("normal");
            doc.text(85,115,alumosRowSelectedData.address);

            doc.setFontType("bold");
            doc.text(40,122,"Celular");
            doc.setFontType("normal");
            doc.text(85,122,alumosRowSelectedData.phone);

            doc.setFontType("bold");
            doc.text(40,129,"Correo");
            doc.setFontType("normal");
            doc.text(85,129,alumosRowSelectedData.email);

            doc.setFontType("bold");
            doc.text(40,136,"Colegio");
            doc.setFontType("normal");
            doc.text(85,136,alumosRowSelectedData.colegio);

            doc.setFontType("bold");
            doc.text(40,143,"Año de egreso");
            doc.setFontType("normal");
            doc.text(85,143,alumosRowSelectedData.añoEgreso);

            doc.setFontType("bold");
            doc.text(40,150,"Promedio");
            doc.setFontType("normal");
            doc.text(85,150,alumosRowSelectedData.promedio);

            doc.setFontType("bold");
            doc.text(40,157,"Horario");
            doc.setFontType("normal");
            doc.text(85,157,alumosRowSelectedData.horario);

            doc.setFontType("bold");
            doc.text(40,164,"Prueba optativa");
            doc.setFontType("normal");
            doc.text(85,164,alumosRowSelectedData.electivo);

            doc.line(40, 168, 134, 168);
            doc.setFontType("bold");
            doc.text(40,174,"Apoderado");
            doc.setFontType("normal");
            doc.text(85,174,alumosRowSelectedData.apoderado);

            doc.setFontType("bold");
            doc.text(40,181,"Parentesco");
            doc.setFontType("normal");
            doc.text(85,181,alumosRowSelectedData.parentesco);

            doc.setFontType("bold");
            doc.text(40,188,"Lugar de trabajo");
            doc.setFontType("normal");
            doc.text(85,188,alumosRowSelectedData.workAp);
            
            doc.setFontType("bold");
            doc.text(40,195,"Celular apoderado");
            doc.setFontType("normal");
            doc.text(85,195,alumosRowSelectedData.phoneAp);

            doc.setFontType("normal");
            doc.line(40, 198, 134, 198);
            doc.setFontType("bold");
            doc.text(40,204,"Fecha matrícula");
            doc.setFontType("normal");
            doc.text(85,204,moment(alumosRowSelectedData.date).format('DD/MM/YYYY'));

            doc.setFontType("bold");
            doc.text(40,211,"Tipo de curso");
            doc.setFontType("normal");
            doc.text(85,211,alumosRowSelectedData.tipoCurso);

            doc.setFontType("bold");
            doc.text(40,218,"Forma de pago");
            doc.setFontType("normal");
            doc.text(85,218,alumosRowSelectedData.formaP);
            
            doc.setFontType("italic");
            doc.setFontSize(9);
            doc.text(35,270,"Dirección: Manuel Montt #358 - Contacto: contacto@cebal.cl - Fono: 75 2320402 - www.cebal.cl");
            doc.text(70,275,"Preuniversitario CEBAL - Sólido en P.S.U");
            doc.save(`FichaMatricula`+ `${alumosRowSelectedData.name}.pdf`);
        })

     })
    };


    $('#pagosEnrolled').on('click', function(){
        pagosModal();

    })
    function pagosModal() { 
    let maxCuotas = alumosRowSelectedData.numCuotas
    let montoTotal = 0
      $('#modalEstudiantes').modal();
      $('#modal_title').text('Pago de cuotas');
      $('#modal_body').html(`
        <div class="card  mb-12" style="max-width: 50rem;">
            <div class="card-header"><h5>Datos estudiante</h5></div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <label style="float:left;"><i class="fa fa-user"></i> Rut</label>
                        <input id="modRut" type="text" value="${alumosRowSelectedData._id}"  required class="form-control border-input" readOnly>
                    </div>
                    <div class="col-md-4">
                        <label style="float:left;"><i class="fa fa-user"></i> Nombre</label>
                        <input id="modName" type="text" value="${alumosRowSelectedData.name}"  required class="form-control border-input" readOnly>
                    </div>
                    <div class="col-md-4">
                        <label style="float:left;"><i class="fa fa-key"></i> Cuotas</label>
                        <input id="cuotasPorPagar" type="text" value="${alumosRowSelectedData.numCuotas}"  required class="form-control border-input" readOnly>
                    </div>
                    <div class="col-md-4">
                        <label style="float:left;"><i class="fa fa-key"></i> Valor cuota</label>
                        <input id="x" type="text" value="${alumosRowSelectedData.montoCuota}"  required class="form-control border-input" readOnly>
                    </div>
                    <div class="col-md-4">
                        <label style="float:left;"><i class="fa fa-key"></i> Total restante</label>
                        <input id="x" type="text" value="${alumosRowSelectedData.montoTotal}"  required class="form-control border-input" readOnly>
                    </div>
                </div>
            </div>
            </div>
        </div>
                

        <div class="card  mb-12" style="max-width: 50rem;margin-top:10px" >
            <div class="card-header"><h5>Cancelación de cuotas</h5></div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <label><i class="fas fa-list-ol"></i> N° Cuotas</label>
                        <input class="form-control" id="numCuotas" type="number" max="${maxCuotas}" min="1" onKeyPress="if(this.value.length==1) return false;" placeholder="Ej: ${maxCuotas}">
                    </div>
                    <div class="col-md-4"> 
                        <label><i class="fas fa-money-check-alt"></i> Monto</label>
                        <input class="form-control" id="amount" type="text" disabled>
                    </div>
                    <div class="col-md-4"> 
                        <label><i class="fas fa-ticket-alt"></i> N° Boleta</label>
                        <input class="form-control" id="ticket" type="number" placeholder="ej: 1234">
                    </div>
                    <div class="col-md-4">
                        <label><i class="fas fa-calendar-alt"></i> fecha </label>
                        <input  id="initDate" placeholder="Fecha de inicio (Día/Mes/Año)" class="form-control" type="text">
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="row"> 
                <div class="offset-md-6 col-md-3" style="margin-top:15px;">
                    <button id="cancel" class="btn btn-danger btn-block"><i class="fas fa-ban"></i> Cancelar</button>
                </div>
                <div class="col-md-3" style="margin-top:15px;">
                    <button id="save" class="btn btn-primary btn-block" disabled><i class="fas fa-cloud"></i> Guardar</button>
                </div>
        </div>
        </div>
      `)
    pagos()  
    $('#ticket').on('change', function (e){
        saveTicket()
    })
    function saveTicket(){
        let ticket = $('#ticket').val()
        if(ticket === ''){
            $('#save').prop('disabled', true)
        }else{
            $('#save').prop('disabled', false)
        }
    }

    function pagos (){
        $('#numCuotas').on('change', function (e){
            let nCuotas  = $('#numCuotas').val()
            let mCuota = alumosRowSelectedData.montoCuota
            let montoTotal= nCuotas*mCuota
            $('#amount').val(montoTotal)
        })
    }
    //GUARDAR PAGOS
    let rutAlumno= $('#modRut').val()
    
    let tipoPago = $('#payment').val()
    let Monto    = $('#amount').val()
    let nBoleta  = $('#ticket').val()
    let datePago = $('#initDate').val()
     

        
        $('#cancel').on('click', function () {
            $('#modalEstudiantes').modal('hide')
        })
        //fecha
        $('#initDate').daterangepicker({
        "locale": {
            "format": "DD/MM/YYYY",
            "daysOfWeek": [
            "Dom",
            "Lun",
            "Mar",
            "Mie",
            "Jue",
            "Vie",
            "Sab"
            ],
            "monthNames": [
            "Enero",
            "Febrero",
            "Marzo",
            "Abril",
            "Mayo",
            "Junio",
            "Julio",
            "Agosto",
            "Septiembre",
            "Octubre",
            "Noviembre",
            "Diciembre"
            ],
            "firstDay": 1
        },
        drops: "up",
        singleDatePicker: true,
        showDropdowns: true
    });

    };
</script>
{{/extend}}

